<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tag B03</title>
<style>
#tagBox {
  width: 200px;
  height: 200px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2em;
  color: #fff;
  border-radius: 20px;
  cursor: pointer;
  user-select: none;
}
.sain { background-color: #2ecc71; }
.contamine { background-color: #e74c3c; }
</style>
</head>
<body>
<div id="tagBox">B03</div>
<script>
const tagId = "B03";
const binURL = "https://api.jsonbin.io/v3/b/6920c18ad0ea881f40f760fe";
const apiKey = "$2a$10$FYbI.UBUR9uUn20mH5/nAesXEm4NPygH2n0HPRBlgSa8j/VmI8LD2";

async function loadState() {
  const res = await fetch(binURL, { headers: { "X-Master-Key": apiKey }});
  const data = await res.json();
  const state = data.record[tagId];
  setBox(state);
}

function setBox(state) {
  const box = document.getElementById("tagBox");
  box.className = state;
}

async function setState(state) {
  const res = await fetch(binURL, { headers: { "X-Master-Key": apiKey }});
  const data = await res.json();
  const json = data.record;
  json[tagId] = state;
  await fetch(binURL, {
    method: "PUT",
    headers: {
      "Content-Type": "application/json",
      "X-Master-Key": apiKey,
      "X-Bin-Versioning": "false"
    },
    body: JSON.stringify(json)
  });
  setBox(state);
}

const box = document.getElementById("tagBox");
box.addEventListener("click", () => {
  const newState = box.className === "sain" ? "contamine" : "sain";
  setState(newState);
});

loadState();
</script>
</body>
</html>